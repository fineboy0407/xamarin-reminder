<div class="container" style="padding-top: 20px;">
    <div class="row">
        <div class="col-md-5">
            <div class="row">
                <div class="row">
                    <div class="col-xs-12" id="notesList">
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-7" id="noteDetails">
            <h2>No note selected</h2>
        </div>
    </div>

    <a class="round-button" id ="newNoteLink"><h1>+</h1></a>
    <!-- Loading indicator -->
    <div class="loader"></div>

    <!-- Full size image -->
    <div id="modalImage" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="img01" />
        <div id="caption"></div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $.ajax({
            url: "/api/notes",
            type: "GET",
            headers: { "Authorization": "Bearer " + localStorage.getItem("token") },
            success: function (data) {
                console.log(data);
                if (data.length !== 0) {
                    for (var i = 0; i < data.length; i++) {
                        var html = "<a style=\"cursor: pointer\" class=\"list-group-item clearfix\" id=\"" + data[i].Id + "\">" + "<span class=\"pull - left\">";

                        if (data[i].Photos[0] !== undefined) {
                            html += "<img src=\"data:image/gif;base64, " +
                                data[i].Photos[0].Image +
                                "\" alt=\"Note photo\" class=\"img-responsive\" " +
                                "style=\"max-width: 160px; max-height: 100px;\" />";
                        }
                        html += "</span>";
                        html += "<div class=\"pull-right text-container\"><h4 class=\"list-group-item-heading\">" + moment(data[i].CreationDate).format("LL") + "</h4>" +
                            "<p class=\"list-group-item-text\">" + data[i].Description + "</p></div></a>";

                        $("#notesList").append(html);
                    }

                    $(".list-group-item").click(function () {
                        $(".loader").show();
                        $(this.parentElement.children).removeClass("active");
                        $(this).addClass("active");
                        $(this).css({ "z-index": 0 });

                        $.ajax({
                            url: "api/notes/" + this.id,
                            type: "GET",
                            headers: { "Authorization": "Bearer " + localStorage.getItem("token") },
                            success: function(note) {
                                $(".loader").hide();

                                var html = "<div class=\"row\">";

                                if (note.Photos[0] !== undefined) {
                                    html += "<div class=\"col=xs-12\" id=\"photos-container\">";

                                    console.log(note.Photos[0]);
                                    html += "<img src=\"data:image/gif;base64, " +
                                        note.Photos[0].Image + "\" id=\"" + note.Photos[0].Id +
                                        "\" alt=\"No photo\" class=\"img-responsive\"" +
                                        "style=\"max-height: 300px; cursor: pointer;\" />";

                                    html += "</div>";
                                } else {
                                    html += "<div class=\"col-xs-12\"><h2>No photos</h2></div>";
                                }
                                html += "<div class=\"col-xs-12\"><p>" + note.Description + "</p></div></div>";
                                $("#noteDetails").html(html);
                                setPhotoImageClickListener();
                            },
                            error: function(error) {
                                console.log(error);
                                $(".loader").hide();
                            }
                        });
                    });
                }
            },
            error: function(error) {
                console.log(error);
            }
        });

        function setPhotoImageClickListener() {
            $("#photos-container img").click(function () {
                $("#modalImage").css({ display: "block" });
                $("#img01").attr("src", this.src);
                $("#caption").html(this.alt);

                $(".close").click(function () {
                    $("#modalImage").css({ display: "none" });
                });
            });
        };
        
        
        $(".loader").hide();

        $("#newNoteLink").click(function() {
            $("#formsContainer").load("@Url.Action("CreateNote","Home")");
        });
    });
</script>